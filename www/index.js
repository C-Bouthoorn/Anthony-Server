// Generated by CoffeeScript 1.10.0
/*jshint jquery: true*///;
/*globals io:false, console:false *///;
'use strict';
var init, login, register, safe, setstatus, socket;

socket = null;

setstatus = function(stat, subscr, iserror) {
  var elem, html;
  if (typeof subscr !== 'string') {
    iserror = subscr;
    subscr = '';
  }
  elem = $('#connstatus');
  html = stat + '<br><small>' + subscr + '</small>';
  elem.html(html);
  if (iserror) {
    return elem.addClass('error');
  } else {
    return elem.removeClass('error');
  }
};

safe = function(callback) {
  var err, error;
  try {
    return callback();
  } catch (error) {
    err = error;
    console.log(err);
    return setstatus(err.message, true);
  }
};

init = function() {
  return safe(function() {
    socket = io.connect();
    socket.on('connect', function() {
      return setstatus('Connected to the server!');
    });
    socket.on('disconnect', function() {
      return setstatus('Lost connection!', true);
    });
    return $('#password').keyup(function(event) {
      if (event.keyCode === 13) {
        return $('#btn').click();
      }
    });
  });
};

login = function() {
  return safe(function() {
    var pass, user;
    user = $('#username').val();
    pass = $('#password').val();
    socket.on('login-complete', function(data) {
      return setstatus("Welcome " + user + "!", "Psst: " + data.secret);
    });
    socket.on('login-failed', function(data) {
      return setstatus('Failed to login:', data.error, true);
    });
    return socket.emit('login', {
      user: user,
      pass: pass
    });
  });
};

register = function() {
  return safe(function() {
    var pass, user;
    user = $('#username').val();
    pass = $('#password').val();
    socket.on('register-complete', function(data) {
      return setstatus("Welcome to our server, " + user + " !");
    });
    socket.on('register-failed', function(data) {
      return setstatus('Failed to register', data.error, true);
    });
    return socket.emit('register', {
      user: user,
      pass: pass
    });
  });
};
